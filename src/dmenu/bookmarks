#!/usr/bin/env bash

declare -r path="$HOME/w/b/generic"

clipboard() {
    local clipboard
    clipboard="$(xclip -selection clipboard -out)"
    echo "$clipboard"
}

copy() {
    local text
    text="$(clipboard)"
    if [[ "$text" == http* ]];then
        echo "$text" >> $path
    fi
}

show() {
    local url
    url="$(grep "^http" "$path" | dmenu -l 10)"
    echo "$url"
}

open() {
    local url="$1"
    if [[ -n "$url" ]];then
        xdg-open "${url%% *}" &> /dev/null &
        if (( $? == 0 ));then
            disown
        fi
    fi
}

main() {
    local url
    local action="$1"
    case "$action" in
        write)
            copy
            ;;
        open)
            url="$(show)"
            open "$url"
            ;;
    esac
}

main "$@"

